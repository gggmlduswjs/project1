<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>장바구니 페이지</title>
    <style>
        /*임의 지정*/
        body {
            box-sizing: border-box;
            background-color: #f3f4f6;
            font-family: 'Noto Sans KR', sans-serif;
        }

        header {
            width: 100vw;
            height: 70px;
            background-color: black;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 60px;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 999;
        }

        nav {
            display: flex;
            gap: 25px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-size: 13px;
            letter-spacing: 1px;
            font-weight: 400;
        }

        .logo {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            /* 수직 정렬 */
            justify-content: center;
            height: 70px;
        }

        .logo img {
            height: 30px;
            /* 원본 로고에 맞게 조절 */
            object-fit: contain;
        }

        .utility {
            display: flex;
            gap: 20px;
        }

        .utility img {
            width: 18px;
            height: 18px;
            filter: brightness(0) invert(1);
            opacity: 0.8;
        }

        .utility a:hover img {
            opacity: 1;
        }

        /*section css*/
        section {
            width: 100%;
            padding-top: 110px;
        }

        .cart-menu {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .cart-menu-item {
            list-style: none;
            display: flex;
        }

        .cart-menu-item li {
            margin-right: 20px;
        }

        .cart-menu-item button {
            border: none;
            font-size: 19px;
            padding: 9px 20px;
            cursor: pointer;
            color: #8c8989;
            background-color: transparent;

            position: relative;
            transition: color 0.3s ease;
        }

        .cart-menu-item button:focus {
            color: black;
            background-color: #cecece;
            border-radius: 12px;
        }

        .cart-menu-item span {
            color: rgb(54, 54, 54);
            position: absolute;
            top: 0;
            right: 7px;
        }

        .cart-close {
            width: 25px;
            height: 25px;
            background-image: url(./assets/icons/cart-close.png);
            background-position: center;
            background-size: cover;
            position: absolute;
            right: 20px;
        }

        /*장바구니 전체 css*/
        .cart-wrap {

            width: 100%;
            margin-top: 50px;
            position: relative;
            display: inline-block;
            box-sizing: border-box;
        }

        /*장바구니 리스트 부분*/
        #cart-list {
            width: 50%;
            height: 900px;
            margin-left: 150px;
        }

        .cart-list-ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .list-item {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .list-item-img {
            width: 300px;
            height: 300px;
        }

        .item-color {
            font-size: 12px;
        }

        .item-delete {
            border: none;
            background-color: #d3d3d3;
            font-size: 12px;
            padding: 10px 5px;
            border-radius: 5px;
        }

        .item-delete:hover {
            background-color: #000000;
            color: white;
        }

        .count-select {
            border: none;
            width: 55px;
            padding: 3px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .count-delete {
            text-align: center;
            width: 150px;
        }

        /*장바구니 리스트 - 전체삭제 버튼 부분*/
        .cart-all-delete {
            border-top: 1px solid #333;
            height: 109px;
            width: 50%;
            position: absolute;
            left: 150px;
            font-size: 13px;
        }

        .cart-all-delete>div {
            width: 100%;
            text-align: center;
            padding: 35px 0;
        }

        .cart-all-delete button {
            margin-left: 40px;
        }

        /*결제정보*/
        #cart-buy-wrap {
            height: 1000px;
            width: 30%;
            position: absolute;
            top: 100px;
            right: 20px;
            padding: 20px;
            box-sizing: border-box;
        }

        .hidden {
            display: none;
        }

        .cart-price {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
        }

        .price-font {
            font-size: 19px;
            font-weight: 500;
        }

        .buy-wrap-btn {
            width: 100%;
            border: none;
            background-color: #000000;
            color: white;
            padding: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .strong-btn {
            background-color: transparent;
            border: 1px solid #757575;
        }

        .strong-btn:hover {
            background-color: rgb(211, 211, 211);
            border: none;
        }


        /*부가정보 부분*/
        .check-info {
            margin-top: 100px;
        }

        .check-info-cnt {
            border-bottom: 1px solid #afafaf;
            margin-bottom: 10px;
        }

        .check-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            color: #555;
            line-height: 1.8;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .check-content.show {
            max-height: 500px;
        }

        .toggle-btn {
            border: none;
            background: none;
            cursor: pointer;
            font-size: 16px;
        }

        /*위시리스트 창 - 성빈님*/
        #wishlist-panel {
            position: fixed;
            top: 120px;
            right: -350px;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.2);
            width: 300px;
            background: white;
            border: 1px solid #ddd;
            padding: 16px;
            transition: right 0.3s ease;
            z-index: 2000;
        }

        #wishlist-panel.show {
            right: 20px;
        }

        #wishlist-close {
            position: absolute;
            top: 10px;
            right: 10px;
            border: none;
            background: none;
            font-size: 18px;
            cursor: pointer;
        }

        #wishlist-content .wishlist-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #wishlist-content .wishlist-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            border: 1px solid #eee;
        }
    </style>
    <script>
        // 장바구니 배열
        const products = [  // 위시리스트에서 사용하기 위해 전역변수로 사용
            {
                img: "./assets/products/product1.jpg",
                title: "레이디 랭 RC",
                color: "블랙 / 브라운",
                price: 289000,         //계산용
                qty: 1
            },
            {
                img: "./assets/products/product19.jpg",
                title: "던스 01",
                color: "블랙",
                price: 340000,
                qty: 1
            },
            {
                img: "./assets/products/product3.jpg",
                title: "캐럿 02",
                color: "화이트",
                price: 360000,
                qty: 1
            }
        ];

        //위시리스트 배열
        const wishlist = [];

        // renderDiv() : 장바구니 상품 리스트 그리기
        function renderDiv() {
            const list = document.getElementById("cart-list");
            list.innerHTML = "";

            //장바구니가 비어있을 때
            if (products.length === 0) {
                list.innerHTML = "<p style='text-align:center; padding:50px 0; font-size:18px; margin-top:130px;'>쇼핑백에 추가된 제품이 없습니다.</p>";
                updateCartCount();
                totalPrice();
                return;
            }
            //장바구니 리스트 생성
            const ul = document.createElement("ul");
            ul.classList.add("cart-list-ul");

            products.forEach(function (item, index) {
                const li = document.createElement("li");
                li.innerHTML = `
                <div class = "list-item">
                   
                    <div><input type="checkbox" class = "cb" data-index = "${index}"></div>
                    <div><img class = "list-item-img" src="${item.img}" alt="${item.title}"></div>
                    
                    <div>
                        <p>${item.title}</p>
                        <p class = "item-color">${item.color}</p>
                        <p class = "amt">₩ ${item.price.toLocaleString()}</p>
                    </div>

                    <div class = "count-delete">
                        수량 <select class="count-select" onchange="calPrice(this, ${index})">
                                    ${[...Array(5)].map((_, i) => `
                                        <option value="${i + 1}" ${item.qty === i + 1 ? 'selected' : ''}>${i + 1}</option>
                                    `).join("")}
                        </select>
                        <div class = "item-delete-wrap"><button onclick= "itemDelete(${index})" class="item-delete">삭제하기</button></div>
                    </div>

                    <div><img src = "./assets/icons/즐겨찾기1.png" art = "북마크" class="bookmark-icon" data-index="${index}" style = "width:25px; height:25px; cursor:pointer;"></div>
                </div>
                `;
                ul.appendChild(li);
            });
            list.appendChild(ul);

            updateCartCount();
            updateWishCount();
            totalPrice();

            //체크박스 이벤트
            checkBoxListener();


            //북마크
            const bookmark = document.querySelectorAll(".bookmark-icon");

            bookmark.forEach(function (icon) {
                icon.addEventListener("click", function () {
                    toggleBookmark(this);
                });
            });

        }

        //체크박스 이벤트
        function checkBoxListener() {
            const allcb = document.querySelector(".all_cb");
            const checkBoxes = document.querySelectorAll(".cb");

            checkBoxes.forEach(cb => {  //개별 체크박스 변경 시
                cb.addEventListener("change", function () {
                    let allChecked = true;
                    checkBoxes.forEach(function (box) {
                        if (!box.checked) {
                            allChecked = false;
                        }
                    });
                    allcb.checked = allChecked;
                    totalPrice();
                });
            });

            allcb.addEventListener("change", function () {    //전체 체크박스 변경 시
                checkBoxes.forEach(cb => cb.checked = allcb.checked);
                totalPrice();
            });
        }

        //수량 변경 시 금액 변경
        function calPrice(selectTag, index) {
            let qty = parseInt(selectTag.value);
            products[index].qty = qty;  // 배열의 상품 수량 변경

            const li = selectTag.closest("li");
            li.querySelector(".amt").textContent = "₩ " + (products[index].price * qty).toLocaleString();

            totalPrice();   //총계 갱신
        }

        //총계
        function totalPrice() {
            let sum = 0;

            //체크 되어있을 때 
            document.querySelectorAll(".cb").forEach((cb, i) => {
                if (cb.checked) {
                    sum += products[i].qty * products[i].price;
                }
            });

            //총계 표시
            const totalPriceEls = document.querySelectorAll(".total-price");
            const spanTotalPrice = document.querySelector(".buy-wrap-btn span");

            totalPriceEls.forEach(price => price.textContent = "₩ " + sum.toLocaleString());
            spanTotalPrice.textContent = "₩ " + sum.toLocaleString();
        }

        //장바구니 담긴 개수 업데이트
        function updateCartCount() {
            const cartcount = document.querySelector(".cart-count");
            cartcount.textContent = products.length;
        }

        //위시리스트 개수 업데이트
        function updateWishCount() {
            const wishcount = document.querySelector(".wish-count");
            wishcount.textContent = wishlist.length;
        }

        //장바구니 전체 삭제
        function allitemDelete() {
            const allcb = document.querySelector(".all_cb");
            const checkBoxs = document.querySelectorAll(".cb");

            if (!allcb.checked) {
                alert("전체 선택 체크 박스를 먼저 체크해주세요.");
                return;
            }

            for (let i = checkBoxs.length - 1; i >= 0; i--) {
                if (checkBoxs[i].checked) {
                    products.splice(i, 1);
                }
            }
            renderDiv();
        }

        //장바구니 개별 상품 삭제
        function itemDelete(index) {
            products.splice(index, 1);
            renderDiv();
        }

        //위시리스트 js - 성빈님
        function toggleBookmark(img) {
            const defaultIcon = './assets/icons/즐겨찾기1.png';
            const activeIcon = './assets/icons/즐겨찾기2.png';
            const panel = document.getElementById('wishlist-panel');
            const currentSrc = img.getAttribute('src');

            const listItem = img.closest('.list-item');
            const name = listItem.querySelector('p').textContent;
            const colors = listItem.querySelector('.item-color').textContent;
            const productImgUrl = listItem.querySelector('.list-item-img').src;

            if (currentSrc.includes('즐겨찾기1.png')) {
                img.setAttribute('src', activeIcon);

                //위시리스트 배열 추가
                wishlist.push({
                    img: productImgUrl,
                    title: name,
                    color: colors
                });
                updateWishCount();

                const panelContent = document.getElementById('wishlist-content');
                panelContent.innerHTML = `
                    <div class="wishlist-item">
                        <img src="${productImgUrl}" alt="${name}">
                        <p>"${name}"이(가) 위시리스트에 저장되었습니다</p>
                    </div>`;
                panel.classList.add('show');
                clearTimeout(panel._hideTimeout);
                panel._hideTimeout = setTimeout(() => panel.classList.remove('show'), 3000);
            }
            else {
                img.setAttribute('src', defaultIcon);
                clearTimeout(panel._hideTimeout);
                panel.classList.remove('show');
            }
        }

        //위시리스트 구현
        function renderWish() {
            const list = document.getElementById("cart-list");
            list.innerHTML = "";

            // 위시리스트가 비었을 때
            if (wishlist.length === 0) {
                list.innerHTML = `
            <div id="cart-list">
                <p style='text-align:center; padding:50px 0; font-size:18px; margin-top:130px;'>
                    위시리스트에 저장된 제품이 없습니다.
                </p>
            </div>
            `;
                updateWishCount();
                return;
            }

            // 리스트 생성
            const ul = document.createElement("ul");
            ul.classList.add("cart-list-ul");

            wishlist.forEach(function (item, index) {
                const li = document.createElement("li");
                li.innerHTML = `
            <div class="list-item">
                <div><img class="list-item-img" src="${item.img}" alt="${item.title}"></div>
                <div>
                    <p>${item.title}</p>
                    <p class="item-color">${item.color || ''}</p>
                </div>
                <div class="count-delete">
                    <button class="item-delete" onclick="deleteWishlistItem(${index})">북마크 취소</button>
                </div>
            </div>
        `;
                ul.appendChild(li);
            });

            list.appendChild(ul);
            updateWishCount();

        }

        function showCart() {
            renderDiv();
            document.getElementById("cart-buy-wrap").classList.remove("hidden");
            document.querySelector(".cart-all-delete").classList.remove("hidden");
        }

        function showWish() {
            renderWish();
            document.getElementById("cart-buy-wrap").classList.add("hidden");
            document.querySelector(".cart-all-delete").classList.add("hidden");
        }

        //윈도우 로드 시
        window.onload = function () {
            renderDiv();

            //위시리스트 닫기
            document.getElementById('wishlist-close').addEventListener('click', () => {
                const panel = document.getElementById('wishlist-panel');
                clearTimeout(panel._hideTimeout);
                panel.classList.remove('show');
            });

            //부가정보
            const toggleBtn = document.querySelectorAll('.toggle-btn');
            toggleBtn.forEach(btn => {
                btn.addEventListener('click', () => {
                    const content = btn.closest('.check-info-cnt').querySelector('.check-content');
                    content.classList.toggle('show');
                });
            });

        }

    </script>
</head>

<body>
    <header>
        <!-- 좌측 메뉴 -->
        <nav>
            <a href="./product.html">선글라스</a>
            <a href="#">안경</a>
            <a href="#">컬렉션</a>
            <a href="#">스토어</a>
            <a href="#">더 알아보기</a>
        </nav>

        <!-- 가운데 로고 -->
        <div class="logo">
            <img src="./assets/logo/logo1.png">
        </div>

        <!-- 우측 아이콘 -->
        <div class="utility">
            <a href="./search.html"><img src="./assets/icons/search1.png" alt="검색"></a>
            <a href="./login .html"><img src="./assets/icons/mypage1.png" alt="마이페이지"></a>
            <a href="./cart.html"><img src="./assets/icons/cart1.png" alt="장바구니"></a>
        </div>
    </header>
    <section>
        <!--메뉴-->
        <div class="cart-menu">
            <ul class="cart-menu-item">
                <li>
                    <button onclick="showCart()">쇼핑백<span class="cart-count">0</span></button>
                </li>
                <li>
                    <button onclick="showWish()">위시리스트<span class="wish-count">0</span></button>
                </li>
            </ul>
            <a href="./index.html" class="cart-close"></a>
        </div>

        <!--장바구니 클릭 시 장바구니 전체(상품 리스트, 결제정보)-->
        <div class="cart-wrap">
            <!--리스트-->
            <div id="cart-list">
                <!--이미지, 상품명, 금액 : 동적 생성-->
            </div>
            <!--결제정보-->
            <div id="cart-buy-wrap">
                <!--소계, 배송비, 총계-->
                <div class="cart-price">
                    <div>소계</div>
                    <div class="total-price">0</div>
                </div>
                <div class="cart-price">
                    <div>배송</div>
                    <div>무료</div>
                </div>
                <div class="cart-price price-font">
                    <div>총계</div>
                    <div class="total-price">0</div>
                </div>
                <!--결제하기, 쇼핑 계속하기-->
                <button class="buy-wrap-btn">결제하기 <span>0</span></button>
                <button class="buy-wrap-btn strong-btn"><a href="./product.html"
                        style="text-decoration: none; color: black;">쇼핑
                        계속하기</a></button>
                <!--부가 정보-->
                <div class="check-info">
                    <div class="check-info-cnt">
                        <div class="check-title">
                            <p>무료배송 & 반품<button class="toggle-btn">></button></p>
                        </div>
                        <div class="check-content">
                            젠틀몬스터 공식 온라인 스토어는 무료 배송 및 반품 서비스를 제공합니다.
                            반품은 제품을 수령하신 날로부터 7일 이내에 접수해 주셔야 합니다.
                            제품은 사용되지 않은 상태여야 하며, 모든 구성품을 포함하고 있어야 합니다.
                        </div>
                    </div>
                    <div class="check-info-cnt">
                        <div class="check-title">
                            <p>무이자 할부 및 다양한 결제 옵션<button class="toggle-btn">></button></p>
                        </div>
                        <div class="check-content">
                            무이자 할부 서비스<br>
                            카드사에서 제공하는 무이자 할부 서비스는 아래 각각의 PG사를 클릭하여 확인하실 수 있습니다.<br>
                            카카오페이 / / KCP(신용카드) / / 토스페이<br>

                            후불 결제 서비스<br>
                            토스페이로 결제하시는 경우 후불 결제 서비스를 이용하실 수 있습니다. 후불 결제와 관련된 자세한 내용은 토스 앱에서 확인하세요.<br>

                            결제 수단<br>
                            KCP(신용카드), 카카오페이, 네이버페이, 토스페이, Apple Pay, 기프트 카드
                        </div>
                    </div>
                </div>
            </div>
            <!--상품 삭제-->
            <div class="cart-all-delete">
                <div>
                    <input class="all_cb" type="checkbox">전체 선택
                    <button class="item-delete" onclick="allitemDelete()">전체 삭제하기</button>
                </div>
            </div>

            <!--위시리스트 창 : 숨겨짐-->
            <div id="wishlist-panel">
                <button id="wishlist-close">x</button>
                <h4>위시리스트에 저장되었습니다</h4>
                <div id="wishlist-content"></div>
            </div>
        </div>

        <!--위시리스트 클릭 시-->
        <div class="wishlist-wrap">

        </div>


    </section>
</body>

</html>